# Проект

Ваша задача — разработать консольное приложение для управления финансами, которое помогает пользователям вести учёт доходов и расходов, анализировать свои финансовые операции и экспортировать данные для дальнейшего использования. Программа ориентирована на удобство, корректность данных и лёгкость анализа статистики.

Проект выполняется в **команде**. Каждый участник команды отвечает за отдельный модуль приложения, разрабатывает функционал, пишет тесты и устраняет ошибки с использованием линтеров.

## **Функционал программы**

1. **Добавление и удаление записей**

   Пользователь может добавлять в файл записи о доходах и расходах с указанием даты, типа операции, категории, описания (необязательно) и суммы. Также есть возможность удалить запись по её ID из файла.
2. **Редактирование записей**

   Пользователь может обновлять существующую запись в файле (например, изменить сумму или категорию).
3. **Поиск записей**

   Пользователь может искать записи в файле по категориям.
4. **Просмотр статистики**

   Пользователь может выбрать период и посмотреть: 
   - общую сумму доходов и расходов;
   - разбивку по категориям.
5. **Экспорт данных**

   Пользователь может экспортировать в файл данные за определённый период.
6. **Тестирование и качество кода**

   Каждый модуль тестируется с использованием `unittest` и проверяется на соответствие стандартам PEP 8 с помощью линтеров `flake8` или `pylint`.

## **Рекомендации для командной работы**

### **Общие задачи команды**

1. Согласовать структуру проекта и данные, которые будут храниться в файле.
2. Структура данных в файле:

   **Формат файла**: CSV.

   **Заголовок**:

   ```
   date,type,category,description,amount
   ```
   - `date`: дата операции в формате `YYYY-MM-DD`;


   - `type`: тип операции: `income` (доход) или `expense` (расход);
   - `category`: категория операции (например, `salary`, `food`);
   - `description`: описание операции (необязательно);
   - `amount`: сумма операции (положительная для доходов, отрицательная для расходов).

   **Пример записи**:
   - доход: `2024-01-01,income,salary,January salary,3000.00`;
   - расход: `2024-01-02,expense,food,Groceries,-150.50`.

   **Хранение**: данные хранятся в текстовом файле с каждой записью в отдельной строке.
3. Прописать функции:
   -  добавление записей в файл `add_record`;
   -  удаление записей из файла `delete_record`;
   -  обновление записей в файле `edit_record`;
   -  поиск записей в файле по категориям `search_records`;
   -  расчёт статистики `calculate_statistics`;
   -  экспорт данных в отдельный файл `export_to_file`.

 

### **Разработчик 1: работа с записями (добавление, удаление и обновление)**

#### **Функционал**

1. Реализовать функции: 
   - `add_record`: добавляет новую запись в файл;
   - `delete_record`: удаляет запись по ID;
   - `edit_record`: обновляет запись по ID.
2. Структура функции `add_record`:

```python
def add_record(file_path, record):
    try:
        # Проверка, что amount является числом
        amount = float(record['amount'])
    except ValueError:
        raise ValueError("Invalid amount value, it must be a number.")

    # Если все проверки прошли, добавляем запись в файл
    with open(file_path, 'a') as file:
        file.write(f"{record['date']},{record['type']},{record['category']},,{amount}\n")
```

3. Структура функции `delete_record`:

```python
def delete_record(file_path, record_id):
    with open(file_path, 'r') as file:
        lines = file.readlines()

    # Удаляем запись с указанным ID (предполагается, что ID — это индекс записи)
    if 0 < record_id <= len(lines):
        del lines[record_id]

    # Перезаписываем файл с удалением
    with open(file_path, 'w') as file:
        file.writelines(lines)
```

4. Структура функции `edit_record`:

```python
def edit_record(file_path, record_id, updated_record):
    with open(file_path, 'r') as file:
        lines = file.readlines()

    # Обновляем запись по ID
    if 0 < record_id <= len(lines):
        lines[
            record_id] = f"{updated_record['date']},{updated_record['type']},{updated_record['category']},,{updated_record['amount']}\n"

    # Перезаписываем файл с обновлённой записью
    with open(file_path, 'w') as file:
        file.writelines(lines)
```

#### **Тестирование**

**Тест для** `add_record`

- Нормальный случай: добавление корректной записи в файл.
- Граничные случаи:
  - дата в неправильном формате (например, 2024-13-32);
  - отрицательная сумма (например, −100);
  - отсутствие обязательных полей (например, если не указана сумма или дата);
  - очень большая сумма (например, 1e10, для проверки работы с большими числами).

**Тест для** `delete_record`

- Нормальный случай: удаление записи по ID, который существует, из файла.
- Граничный случай: удаление записи по несуществующему ID.

**Тест для** `edit_record`

- Нормальный случай: редактирование записи по существующему ID.
- Граничные случаи:
  - попытка редактирования записи по несуществующему ID;
  - обновление записи с некорректными данными (например, отрицательная сумма).

   

### **Разработчик 2: поиск записей и просмотр статистики** 

#### **Функционал**

1. Реализовать функции: 
   - `search_records` ищет записи по категории в файле;
   - `calculate_statistics` возвращает:
     - общую сумму доходов и расходов за выбранный период;
     - разбивку по категориям.
2. Структура функции `search_records`:

```python
def search_records(file_path, search_term):
    results = []
    with open(file_path, 'r') as file:
        lines = file.readlines()
        for line in lines[1:]:  # Пропускаем заголовок
            parts = line.strip().split(',')
            if search_term.lower() in parts[2].lower():  # Ищем по категории
                results.append(line)
    return results
```

3. Структура функции `calculate_statistics`:

```python
def calculate_statistics(file_path, start_date, end_date):
    stats = {'income': 0, 'expense': 0}
    with open(file_path, 'r') as file:
        lines = file.readlines()

        # Проходим по всем строкам данных, пропуская заголовок
        for line in lines[1:]:
            parts = line.strip().split(',')
            try:
                record_date = datetime.datetime.strptime(parts[0], "%Y-%m-%d")  # Понимание формата
                if start_date <= record_date <= end_date:
                    if parts[1] == 'income':
                        stats['income'] += float(parts[4])
                    elif parts[1] == 'expense':
                        stats['expense'] += float(parts[4])
            except ValueError:
                continue  # Пропускаем некорректные строки
    return stats
```

#### **Тестирование**

**Тест для** `search_records`

- Нормальный случай: поиск записей по категории в файле.
- Граничные случаи:
  - поиск по категории, которой нет в базе данных;
  - поиск по пустой категории.

**Тест для** `calculate_statistics`

- Нормальный случай: получение общей суммы доходов и расходов за период.
- Граничные случаи:
  - период, в котором нет записей (например, фильтрация по пустому диапазону);
  - период, где записи только одного типа (только доходы или только расходы);
  - очень большой диапазон дат (например, более 100 лет).

 

### **Разработчик 3: экспорт данных**

#### **Функционал**

1. Реализовать функцию `export_to_file`, которая экспортирует данные за выбранный период в отдельный файл.
2. Проверить, что данные в файле соответствуют записям из исходного файла.
3. Форматирование: данные должны быть структурированы и удобны для чтения и обработки.
4. Структура функции `export_to_file`:

```python
def export_to_file(file_path, output_path, start_date, end_date):
    with open(file_path, 'r') as file:
        lines = file.readlines()

    with open(output_path, 'w') as output_file:
        output_file.write(lines[0])  # Записываем заголовок
        for line in lines[1:]:
            parts = line.strip().split(',')
            try:
                record_date = datetime.datetime.strptime(parts[0], "%Y-%m-%d")
                if start_date <= record_date <= end_date:
                    output_file.write(line)  # Записываем строки в новый файл
            except ValueError:
                continue  # Пропускаем некорректные строки
```

#### **Тестирование**

#### **Тест для** `export_to_file`

- Нормальный случай: экспорт данных в корректно форматированный файл CSV.
- Граничные случаи:
  - экспорт данных за период, в котором нет записей;
  - экспорт данных с неверно отформатированным диапазоном (например, неправильный формат дат в параметре);
  - проверка правильности сохранённого файла (сравнение содержимого).

    

**Ожидания от теста**

- **Наличие файла.** Проверь, что файл создаётся после вызова `export_to_file`.
- **Правильность данных:**
  - все записи соответствуют указанному периоду;
  - структура файла соответствует требованиям;
  - проверь, что нет лишних или отсутствующих записей.
- **Обработка некорректных ситуаций:**
  - если фильтр не возвращает записи, файл должен быть пустым или содержать заголовок без данных;
  - если переданы некорректные параметры (например, невалидный формат дат), должна быть обработка этой ситуации и отсутствие файла.

## **Рабочий процесс команды**

1. **Создание репозитория**

   Настройте Git, организуйте ветки для каждого модуля.
2. **Разработка**

   Каждый студент разрабатывает свой модуль, добавляет тесты, проверяет код линтером `flake8` или `pylint` (выберите один линтер для команды).
3. **Код-ревью**

   Проверьте код коллег перед слиянием в основную ветку.
4. **Интеграция**

   Соберите модули в единое приложение.
5. **Финальное тестирование**

   Проверьте программу на соответствие всем требованиям, включая совместимость модулей.

  